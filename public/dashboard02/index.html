<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Dashboard</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<style>
		.chart-container {
			width: 80%;
			margin: 50px auto;
		}
	
	
	</style>
</head>

<body onload="chamafuncoes()">
	<script data-jsd-embedded data-key="fd5fd562-8848-4c99-842c-c1325101f6b6" 
	data-base-url="https://jsd-widget.atlassian.com" 
	src="https://jsd-widget.atlassian.com/assets/embed.js"></script>


	<div class="container">
		<nav class="navigation">
			<ul>
				<li>
					<a href="#">
						<img class="logo" src="img/logo.svg" alt="">
					</a>
				</li>
				<li>
					<a href="#">
						<span class="icon"><ion-icon name="stats-chart-outline"></ion-icon></span>
						<span class="title">Dashboard</span>
					</a>
				</li>

				<li>
					<a href="#">
						<span class="icon"><ion-icon name="help-outline"></ion-icon></span>
						<span class="title">Suporte Tecnico</span>
					</a>
				</li>
				<li>
					<a href="#">
						<span class="icon"><ion-icon name="settings-outline"></ion-icon></span>
						<span class="title">Configurações</span>
					</a>
				</li>
				</li>
				<li>
					<a href="../homeDashboard.html">
						<span class="icon"><ion-icon name="log-out-outline"></ion-icon> </span>
						<span class="title">Sair</span>
					</a>

				</li>
			</ul>
		</nav>

		<div class="main">
			<div class="topbar" onclick="mudaUmidade()">
				<div class="toggle">
					<ion-icon name="menu-outline"></ion-icon>
				</div>



				<div class="user">
					<img src="img/person-circle-outline.svg">
				</div>

			</div>


			<div class="cardBox">
				<div class="card">
					<div>
						<div class="numbers" id="mostra_temperaturaAtual">20ºC</div>
						<div class="cardName">Temperatura Atual</div>
					</div>
					<div class="iconBx">
						<ion-icon name="thermometer-outline"></ion-icon>
					</div>
				</div>
			</div>

			<div class="cardBox">
				<div class="card">
					<div>
						<div class="numbers" id="mostra_umidade">20%</div>
						<div class="cardName">Umidade Atual</div>
					</div>
					<div class="iconBx">
						<ion-icon name="water-outline"></ion-icon>
					</div>
				</div>
			</div>

			<div class="cardBox">
				<div class="card">
					<div>
						<div class="numbers">20ºC</div>
						<div class="cardName">Temperatura Ideal</div>
					</div>
					<div class="iconBx">
						<ion-icon name="thermometer-outline"></ion-icon>
					</div>
				</div>
			</div>

			<div class="cardBox">
				<div class="card">
					<div>
						<div class="numbers">11% á 12%</div>
						<div class="cardName">Umidade Ideal</div>
					</div>
					<div class="iconBx">
						<ion-icon name="water-outline"></ion-icon>
					</div>
				</div>
			</div>
			
			<!-- Adicione os elementos canvas aqui -->
			<div class="chart-container">
				<canvas id="temperaturaChart"></canvas>
			</div>
			
			<div class="chart-container">
				<canvas id="umidadeChart"></canvas>
			</div>
			

			<div class="span_historic">
				<Span>Historico de Temperatura</Span>
				<span class="icon"><ion-icon size="large" name="reader-outline" style="color: #6F4026;"></span>
			</div>

			<div class="historic">

				<div class="column">Data</div>
				<div class="column">Hora</div>
				<div class="column">Temperatura</div>
				<div class="column">Status</div>

				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">20ºC</div>
					<div class="cell">Bom</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">19ºC</div>
					<div class="cell">Bom</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">20ºC</div>
					<div class="cell">Bom</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">20ºC</div>
					<div class="cell">Bom</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">22ºC</div>
					<div class="cell">Ruim</div>
				</div>
			</div>

			<div class="span_historic">
				<Span>Historico de Umidade</Span>
				<span class="icon"><ion-icon size="large" name="reader-outline" style="color: #6F4026;"></span>
			</div>

			<div class="historic">

				<div class="cell">08/05/2024</div>
				<div class="cell">12:09PM</div>
				<div class="cell">65%</div>
				<div class="cell">Bom</div>

				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">63%</div>
					<div class="cell">Bom</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">65%</div>
					<div class="cell">Bom</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">65%</div>
					<div class="cell">Bom</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">70%</div>
					<div class="cell">Ruim</div>
				</div>
				<div class="row">
					<div class="cell">08/05/2024</div>
					<div class="cell">12:09PM</div>
					<div class="cell">80%</div>
					<div class="cell">Ruim</div>
				</div>
			</div>



		</div>

	</div>



	<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
	<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

	<script>
		// MenuToggle
		let toggle = document.querySelector('.toggle');
		let navigation = document.querySelector('.navigation');
		let main = document.querySelector('.main');

		toggle.onclick = function () {
			navigation.classList.toggle('active');
			main.classList.toggle('active')
		}

		// add hovered class in selected list item
		let list = document.querySelectorAll('.navigation li');
		function activeLink() {
			list.forEach((item) =>
				item.classList.remove('hovered'));
			this.classList.add('hovered')
		}
		list.forEach((item) =>
			item.addEventListener('mouseover', activeLink));

	</script>

</body>

</html>
<script>
    const labels = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho"];

    const dataTemperatura = {
        labels: labels,
        datasets: [{
            label: 'Temperatura (ºC)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            data: [22, 21, 23, 24, 25, 20],
            fill: false,
        }]
    };

    const dataUmidade = {
        labels: labels,
        datasets: [{
            label: 'Umidade (%)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            data: [60, 62, 58, 57, 59, 65],
            fill: false,
        }]
    };

    const configTemperatura = {
        type: 'line',
        data: dataTemperatura,
        options: {
            responsive: true,
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Mês'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Temperatura (ºC)'
                    }
                }
            }
        }
    };

    const configUmidade = {
        type: 'line',
        data: dataUmidade,
        options: {
            responsive: true,
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Mês'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: 'Umidade (%)'
                    }
                }
            }
        }
    };

    window.onload = function() {
        const ctxTemperatura = document.getElementById('temperaturaChart').getContext('2d');
        new Chart(ctxTemperatura, configTemperatura);

        const ctxUmidade = document.getElementById('umidadeChart').getContext('2d');
        new Chart(ctxUmidade, configUmidade);
    };
</script>
<script>

	function chamafuncoes(){
		buscarDadosEMostrarGraficos(armazemId)
		atualizarGraficoTemperatura(dados)
		atualizarGraficoUmidade(dados)
		obterIdDoArmazemDaURL()

	}
    function buscarDadosEMostrarGraficos(armazemId) {
        fetch(`/medidas/monitoramento/${armazemId}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },	
        })
        .then(function (resposta) {
            if (!resposta.ok) {
                throw new Error("Erro ao obter os dados de monitoramento.");
            }
            return resposta.json();
        })
        .then(function (dados) {
            atualizarGraficoTemperatura(dados);
            atualizarGraficoUmidade(dados);
        })
        .catch(function (erro) {
            console.error("Erro ao obter os dados de monitoramento: ", erro);
        });


    }

    function atualizarGraficoTemperatura(dados) {
        const rotulos = dados.map(item => item.data_hora);
        const temperaturas = dados.map(item => item.temperatura);

        configTemperatura.data.labels = rotulos;
        configTemperatura.data.datasets[0].data = temperaturas;

        const contextoTemperatura = document.getElementById('temperaturaChart').getContext('2d');
        new Chart(contextoTemperatura, configTemperatura);
	mudaTemperatura()

    }

    function atualizarGraficoUmidade(dados) {
        const rotulos = dados.map(item => item.data_hora);
        const umidades = dados.map(item => item.umidade);

        configUmidade.data.labels = rotulos;
        configUmidade.data.datasets[0].data = umidades;

        const contextoUmidade = document.getElementById('umidadeChart').getContext('2d');
        new Chart(contextoUmidade, configUmidade);
	mudaUmidade()
	setTimeout(() => {
atualizarGraficoUmidade(dados)
}, 5000);
    }

    function obterIdDoArmazemDaURL() {
        const parametrosURL = new URLSearchParams(window.location.search);
        return parametrosURL.get('armazemId');
    }

    window.onload = function() {
        const idDoArmazem = obterIdDoArmazemDaURL();
        if (idDoArmazem) {
            buscarDadosEMostrarGraficos(idDoArmazem);
        } else {
            console.error("ID do armazém não encontrado na URL.");
        }
    };


    function mudaUmidade(){
	let listaumidades = []
	let tamanhoListaUmidade = configUmidade.data.datasets[0].data.length

	for(let contaUmidade = 0 ; contaUmidade < tamanhoListaUmidade ; contaUmidade ++){


listaumidades.push(configUmidade.data.datasets[0].data[contaUmidade])
}
	mostra_umidade.innerHTML = listaumidades[(listaumidades.length -1)] +'%'

	console.log(listaumidades)
    }

  
    function mudaTemperatura(){
	let listaTemperatura = []
	let tamanhoListaTemperatura = configTemperatura.data.datasets[0].data.length


for(let contaTemperatura = 0 ; contaTemperatura < tamanhoListaTemperatura ; contaTemperatura ++){


	listaTemperatura.push(configTemperatura.data.datasets[0].data[contaTemperatura])
}
	mostra_temperaturaAtual.innerHTML = listaTemperatura[(listaTemperatura.length -1)] +  'Cº'
console.log(listaTemperatura)
}
</script>
